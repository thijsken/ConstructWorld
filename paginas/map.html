<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<title>Maps - ConstructWorld</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<style>
body { margin:0; font-family:'Press Start 2P', monospace; color:#fff; overflow-x:hidden; background:#111;}
header, nav, footer { background: rgba(0,0,0,0.7); color:#2ecc71; padding: 20px; text-align:center;}
#map { width:100%; height:600px; border:3px solid #2ecc71; }
.map-buttons button { padding:10px; margin:5px; background:#000; color:#2ecc71; border:2px solid #2ecc71; cursor:pointer; }
.map-buttons button:hover { background:#2ecc71; color:#000; }
</style>
</head>
<body>

<header>
  <h1>Server Maps</h1>
  <p>Kies een map en bekijk de overlay</p>
</header>

<nav class="map-buttons">
  <button onclick="showMap('normal')">Normale Map</button>
  <button onclick="showMap('bedrock')">Bedrock Map</button>
  <button onclick="showMap('test')">Test Map</button>
</nav>

<div id="map"></div>

<script>
// Definieer maps (grote afbeelding URL)
const maps = {
  normal: { title:"Normale Map", description:"Standaard map", image:"https://drive.usercontent.google.com/download?id=1O_TpkgwfojZhMKw55AZCdccCY3qTcr7t&export=view&authuser=0&confirm=t&uuid=562c1d00-5645-4524-b251-3b6161d9c69a&at=AN8xHor3tfDe_3YqzWQrmZPRN16t%3A1757425197777", size:[2048,2048], maxZoom:5 },
  bedrock: { title:"Bedrock Map", description:"Bedrock map", image:"https://i.imgur.com/k5F0L0u.png", size:[2048,2048], maxZoom:5 },
  test: { title:"Test Map", description:"Test map", image:"https://i.imgur.com/4gHk2vC.png", size:[2048,2048], maxZoom:5 }
};

let map = L.map('map', {crs:L.CRS.Simple, minZoom:0, maxZoom:5});
let tileLayer = null;

function showMap(mapId){
    const selected = maps[mapId];
    if(tileLayer) map.removeLayer(tileLayer);

    // Maak canvas tile layer
    tileLayer = L.TileLayer.extend({
        getTileUrl: function(coords){
            // Dynamisch tile slice: bereken canvas gebied
            const zoom = coords.z;
            const tilesPerRow = Math.pow(2, zoom);
            const tileSize = selected.size[0]/tilesPerRow;

            const x = coords.x*tileSize;
            const y = coords.y*tileSize;

            // Canvas genereren en als data URL
            const canvas = document.createElement('canvas');
            canvas.width = 256;
            canvas.height = 256;
            const ctx = canvas.getContext('2d');

            const img = new Image();
            img.crossOrigin="anonymous";
            img.src = selected.image;

            // Omdat image loading async is, teruggeven als Promise werkt niet in Leaflet.
            // Daarom direct image tekenen zodra geladen
            img.onload = ()=>ctx.drawImage(img, x, y, tileSize, tileSize, 0,0,256,256);

            return canvas.toDataURL();
        },
        tileSize: 256,
        maxZoom: selected.maxZoom
    });

    tileLayer = new tileLayer();
    tileLayer.addTo(map);
    map.setView([selected.size[0]/2, selected.size[1]/2], 0);
}

// Start met normale map
showMap('normal');
</script>
</body>
</html>
